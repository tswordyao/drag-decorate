(function(e){var t=window.navigator.userAgent.indexOf("Chrome")>-1;if(!t){document.body.innerHTML='<br><h2>&nbsp;您目前的浏览器不是chrome(谷歌)浏览器，不支持相关操作。 请更换浏览器后再进入本页面。<br><br>&nbsp;<a href="https://www.baidu.com/s?ie=UTF-8&wd=chrome">点击此处下载</a></h2>'}else{var a="";if(typeof getContextPath=="function"){a="../../"}else{window.getContextPath=function(){return"http://localhost:3000"}}var o=getContextPath()+"/goods/appGoodsList";var i=getContextPath()+"/goods/appSaveDecoration";var r=getContextPath()+"/goods/appUploadShopPic";var n=getContextPath()+"/goods/appShopDecoration";var c=function(e){return document.getElementById("temp-"+e).innerHTML};var s=function(e){return document.getElementById("temp-ctrl-"+e).innerHTML};var l={"tb-features":"品牌优势<hr>四个LOGO,醒目展现亲小店的优势","hd-features":"品牌优势<hr>四个LOGO,醒目展现亲小店的优势","bb-features":"品牌优势<hr>四个LOGO,醒目展现亲小店的优势","hd-brands":"各大品牌LOGO陈列<hr>一个品牌一个贴图,琳琅满目,快拖进手机里看看吧~","tb-category":"商品分类<hr>列出宝贝的几大类,供顾客挑选哦~","bb-category":"商品分类<hr>列出宝贝的几大类,供顾客挑选哦~","hd-category":"商品分类<hr>列出宝贝的几大类,供顾客挑选哦~",singleGood:"这是单宝贝模块<hr>拖入手机 ,然后点击,可以在右侧自定义宝贝的信息",doubleGood:"这是双宝贝模块<hr>两个宝贝并列, 拖入手机后点击,在右侧自定义宝贝的信息",singlePic:"单图片模块<hr>一般选择一张宣传热图, 或者,可以一张装饰性的图片.<br>如果是纯装饰性的 ,可以不要文字和链接",slideBox:"轮播图片模块<hr>也称幻灯片,可以选择多张图片(直接输入链接或上传),将在首页自动切换轮播",doublePic:"并列图片<hr>一般用来做品牌区域,块状LOGO图","tb-category":"4格图片<hr>一般用来做品牌或类别分类",wordPic:"图文并茂<hr> 做图需要美工在左侧纯色或留白",bannerPic:"横幅图片<hr>醒目的广告宣传横图,独占一行,可以放入多幅",titleOnly:"纯文字的标题<hr>用于分段标注",wordOnly:"纯粹的文字<hr>说一些你想跟卖家说的话吧",contract:"您的联系方式<hr>写上电话卖家更容易联系到你",singleGoodList:"宝贝列表模块<hr>多行, 每行展示一个宝贝,包括图片,文字介绍和价格.<br>具体设置请拖入手机后, 单击手机内该模块",doubleGoodList:"宝贝列表模块<hr>多行, 每行展示两个宝贝,包括图片,文字介绍和价格.<br>具体设置请拖入手机后, 单击手机内该模块"};var d={"val-singleGood":{href:"#",picPath:a+"img/decorate/re-good.jpg",name:"宝乐滋3罐超值特价装!",price:92},"val-doubleGood":{href:"#",picPath:a+"img/decorate/good17.jpg",name:"漂亮的女童裤子 纯棉",price:56,href2:"#",picPath2:a+"img/decorate/good13.jpg",name2:"小脚裤子批发 颜色多",price2:52},"val-wordPic":{href:"#",imgsrc:a+"img/decorate/word-pic.jpg",desc:"图片描述文字,一些文字,怕怕拉拉,什么的<br>或者,图片可以做成100%<br>文字遮罩在图片左上角<br>这需要图片设计配合<br>左上角统一色调或留白"},"val-slideBox":[{href:"#",imgsrc:a+"img/decorate/slide.jpg"},{href:"#",imgsrc:a+"img/decorate/slide2.jpg"},{href:"#",imgsrc:a+"img/decorate/slide3.jpg"}],"val-singlePic":{href:"#",imgsrc:a+"img/decorate/baby-house.jpg",desc:"婴童夏装换季清仓中! 点击进入专区!"},"val-doublePic":{href:"#",imgsrc:a+"img/decorate/baby-joy01.jpg",desc:"童车特价中! 点击进入专区!",href2:"#",imgsrc2:a+"img/decorate/baby-joy02.jpg",desc2:"玩具特价! 点击进入专区!"},"val-tb-category":{href:"#",imgsrc:a+"img/decorate/area-logo-01.jpg",desc:"LOGO AREA<br>奶粉专区",href2:"#",imgsrc2:a+"img/decorate/area-logo-02.jpg",desc2:"LOGO AREA<br>日用品专区",href3:"#",imgsrc3:a+"img/decorate/area-logo-03.jpg",desc3:"LOGO AREA<br>尿不湿专区",href4:"#",imgsrc4:a+"img/decorate/area-logo-04.jpg",desc4:"LOGO AREA<br>妈妈专区"},"val-bannerPic":{imgsrc:"img/decorate/banner.jpg",href:"#"},"val-bb-category":{imgsrc:"img/decorate/masonry.png"},"val-bb-features":{imgsrc:"img/decorate/hdnew-features.png"},"val-titleOnly":{title:"推荐宝贝"},"val-wordOnly":{desc:"欢迎光临小店!<br>本店的所有商品都是真宗境外海淘<br>海关保税仓发货, 优惠多多, 还有包邮<br>欢迎亲多多选购~~~ "},"val-contract":{tel:window.telphoneAccount||"1381396655",wechat:window.wechatAccount||"weixina2017006"},"val-hd-category":{href:"1100",imgsrc:a+"img/decorate/category/hd-category01.jpg",title:"奶粉",desc:"全球奶粉跨境购",href2:"1200",imgsrc2:a+"img/decorate/category/hd-category02.jpg",title2:"尿不湿",desc2:"轻松透气一整天",href3:"1300",imgsrc3:a+"img/decorate/category/hd-category03.jpg",title3:"辅食",desc3:"肠胃健康妈妈放心",href4:"1700",imgsrc4:a+"img/decorate/category/hd-category04.jpg",title4:"保健品",desc4:"全球保健品一站购"}};var p={"tb-features":2,"bb-features":2,"hd-features":2,"tb-category":2,"bb-category":2,"hd-category":2,"hd-brands":2,singleGood:8,doubleGood:8,slideBox:1,singlePic:6,bannerPic:6,doublePic:2,wordPic:3,wordOnly:3,titleOnly:12,contract:2,singleGoodList:1,doubleGoodList:1};var f={tempDefault:["singlePic","wordOnly","hd-brands","titleOnly","singleGoodList","contract"],tbstyle:[{name:"singlePic"},{name:"wordOnly"},{name:"tb-features"},{name:"titleOnly",data:{title:"热门品类"}},{name:"tb-category"},{name:"titleOnly"},{name:"doubleGoodList"},{name:"contract"}],bbstyle:[{name:"slideBox"},{name:"bb-features"},{name:"bb-category"},{name:"titleOnly",data:{title:"热门推荐"}},{name:"bannerPic"},{name:"titleOnly",data:{title:"热销宝贝"}},{name:"singleGood",data:{href:"#",picPath:"http://120.26.112.178/statics/attachment/adv/201508251150129137.jpg",name:"德国 碧然德 滤水壶,给健康的限时特价!",price:168}},{name:"singleGood",data:{href:"#",picPath:"http://120.26.112.178/statics/attachment/adv/201508251150511809.jpg",name:"荷兰牛栏三段,市场优选!",price:252}},{name:"singleGood",data:{href:"#",picPath:"http://120.26.112.178/statics/attachment/adv/201508251150338462.jpg",name:"宝宝的小屁屁最好的呵护~~~ 金装尿不湿!",price:268}},{name:"titleOnly"},{name:"doubleGoodList"},{name:"contract"}],hdstyle:[{name:"slideBox",data:[{href:"#",imgsrc:a+"img/decorate/hot.jpg"},{href:"#",imgsrc:a+"img/decorate/hot2.jpg"}]},{name:"hd-features"},{name:"titleOnly",data:{title:"品牌馆"}},{name:"hd-brands"},{name:"titleOnly",data:{title:"热门分类"}},{name:"hd-category"},{name:"titleOnly"},{name:"singleGoodList"},{name:"contract"}]};var g=[];var h=[];var m=[];e.ajax(o).always(function(e){if(e.result){g=e.data;d["val-singleGoodList"]=d["val-doubleGoodList"]=g.slice(0,6)}});var u=e("#temp-good-cell").html();var v=e("#show-mobile");var b='<a class="go-recycle">删除</a><a class="go-up">移上</a><a class="go-down">移下</a>';var w=e(".submit-reset-wrap");var y=e("#ctrl-area");var x=e("#ctrl-wrap");var O;var G=e("#goods-checked-done");var k=e("#goods-list-cls");var P='<a class="all-goods-href">查看所有宝贝&nbsp;&gt;&gt;</a>';var L=e("#goods-checked-list");var j=e("#goods-list");var C=e("#keyword-for-search");var D=e(".alert-assertive");var A=function(t,a){D.fadeIn(300,function(){setTimeout(function(){e(this).fadeOut(600)}.bind(this),a||2400)}).html(function(e,a){return t});return false};D.click(function(){e(this).hide()});window.indexCheckedGoods=window.indexCheckedGoods||[{goods_id:1001},{goods_id:1003},{goods_id:1004},{goods_id:1005},{goods_id:1008},{goods_id:1009}];var T={};window.indexCheckedGoods.forEach(function(e,t){T[e.goods_id||e.goodsId]=e});var _=function(t){t=t||[];var a,o,i,r,n,s,l,f=e("#show-mobile")[0];for(r=0;r<t.length;r++){s=t[r].name;l=t[r].data||d["val-"+s];a=c(s);if(s=="slideBox"){a=a.replace("{imgsrc}",l[0]["imgsrc"]).replace("{href}",l[0]["href"])}else if(s.lastIndexOf("GoodList")>-1){l=l||g.slice(0,8);a=a.replace("{content}",I(l,s.indexOf("single")==0?1:2))}else{for(n in l){a=a.replace("{"+n+"}",l[n])}}i=e(a)[0];i.innerHTML+=b;f.appendChild(i);e(i).data("native",l);p[i.getAttribute("molid")]-=1}e(".go-recycle,.go-up,.go-down").hide()};e("[tempid]").on("click",function(){var t=e(this).attr("tempid");var a;if(t==""){a="\n确定清空? \n\n将清除页面当前的装修预览.\n "}else{a="\n确定应用此模版? \n\n替换页面当前的装修预览.\n "}if(!confirm(a)){return false}e("#show-mobile").find(".mol-wrap").each(function(){e(this).remove();p[this.getAttribute("molid")]++});e("#ctrl-wrap").empty();_(f[t]);e(".submit-reset-wrap").hide();e("#mols-modal").modal("hide");A("操作成功",600)});v.on("drop",function(t){event.preventDefault();var a=event.dataTransfer.getData("Text");var o=a.replace("tag-","");var i=e(".mol-wrap").filter(".blue-top")[0];if(!p[o]&&a.indexOf("tag")==0){A("该组件的使用次数已达上限。");return false}var r=c(o);var n=d["val-"+o]||g.slice(0,8);if(o=="slideBox"){r=r.replace("{imgsrc}",n[0]["imgsrc"]).replace("{href}",n[0]["href"])}else if(o.lastIndexOf("GoodList")>-1){r=r.replace("{content}",I(n,o.indexOf("single")==0?1:2))}else{for(var s in n){r=r.replace("{"+s+"}",n[s])}}var l=e(r)[0];l.innerHTML+=b;i?this.insertBefore(l,i):this.appendChild(l);p[l.getAttribute("molid")]--;e(".mol-wrap").removeClass("blue-top");x[0].innerHTML="";e(l).data("native",n)}).on("dragenter",function(e){}).on("dragover",function(t){event.preventDefault();e(".mol-wrap").removeClass("assertive blue-top");e(event.target).parents(".mol-wrap").eq(0).addClass("blue-top")});e(".mol-tag").on("selectstart",function(e){return false}).on("dragstart",function(e){event.dataTransfer.setData("Text",this.id)}).on("dragend",function(t){event.preventDefault();e(".mol-tip").fadeOut(300,function(){e(this).html('<div class="arrow"></div>')})}).on("mouseover",function(){e(".mol-tip").html('<div class="arrow"></div>');var t=this;e(".mol-tip").show().css("opacity",0).animate({top:e(t).offset().top-80,opacity:.9},"fast",function(){e(this).html(function(e,t){return'<div class="arrow"></div>'+l[this.id.replace("tag-","")]}.bind(t))})}).on("mouseleave",function(){e(".mol-tip").html('<div class="arrow"></div>').hide()}).on("mousedown",function(){e(".mol-tip").fadeOut(300,function(){e(this).html('<div class="arrow"></div>')})});v.on("selectstart",".go-down,.go-up,.go-recycle",function(e){return false}).on("click",".go-recycle",function(t){event.preventDefault();e(this.parentNode).remove();setTimeout(function(){e("#ctrl-wrap").empty();w.hide()},100);p[this.parentNode.getAttribute("molid")]+=1}).on("click",".go-down",function(t){event.preventDefault();var a=this.parentNode;var o=a.nextSibling;if(o==null){return false}var i=e("#show-mobile")[0];var r=a.previousSibling;var n=o.cloneNode(true);i.removeChild(o);i.insertBefore(n,a)}).on("click",".go-up",function(t){event.preventDefault();var a=e(this).parent();var o=a.prev();if(o.length<1){return false}var i=o.clone();var r=a.next();o.remove();r.length?r.before(i):e("#show-mobile").append(i)}).on("mouseover",".mol-wrap",function(t){e(this).find(".go-down,.go-up,.go-recycle").show()}).on("mouseleave",".mol-wrap",function(t){e(this).find(".go-down,.go-up,.go-recycle").hide()}).on("click",".mol-wrap",function(t){h=[];var a=this.getAttribute("molid");var o=e(this).data("native")||d["val-"+a];var i;e(".mol-wrap").removeClass("assertive");e(this).addClass("assertive");e("#ctrl-wrap").data("index",e(this).index()-3).html(s(a));O=e(".mol-ctrl-wrap");if(a=="slideBox"){var r=o;O.find("[mapid^=imgsrc]").each(function(e,t){r[e]?this.value=r[e].imgsrc||"":void 0});O.find("[mapid^=href]").each(function(e,t){r[e]?this.value=r[e].href||"":void 0})}else if(a.indexOf("GoodList")>-1){h=e(this).data("native");S()}else{O.find("input,textarea").each(function(){i=this.getAttribute("mapid")||"none";if(o&&o[i])this.value=(o[i]+"").replace(/\<br\>/gm,"\n")})}a.indexOf("GoodList")>-1||d["val-"+a]?w.show():w.hide()});function S(){var t=e(document.createDocumentFragment());var a;h.forEach(function(o,i){a=e(u.replace(/\{name\}/gm,o["name"]).replace("{picPath}",o["thumbnail"]||o["picPath"]).replace("{href}","#/tab/goods/"+o["goods_id"]||o["goodsId"]).replace("{price}",o["price"]));a.data("good-info",o).html(function(e,t){return t+"<i>×</i>"});if(!T[o["goods_id"]||o["goodsId"]]){a.addClass("disabled")}t.append(a)});e(".ctrlArea-goodsChecked-wrap").empty().append(t)}y.on("click",".submit",function(t){var a=e(".mol-ctrl-wrap").attr("ctrlid"),o=c(a),i,r={},n=v.find(".mol-wrap").eq(+e("#ctrl-wrap").data("index"));if(a.indexOf("GoodList")>-1){o=o.replace("{content}",I(h,a.indexOf("single")==0?1:2));r=h}else if(a=="slideBox"){r=[];e(".mol-ctrl-wrap").find("[mapid^=imgsrc]").each(function(e,t){if(this.value.length>4){r[e]={imgsrc:this.value}}else{r[e]={}}}).end().find("[mapid^=href]").each(function(e,t){typeof r[e]=="object"&&r[e].imgsrc?r[e].href=this.value||"":void 0});o=o.replace("{imgsrc}",r[0]["imgsrc"]).replace("{href}",r[0]["href"])}else{e(this.parentNode).prev().find("input,textarea").each(function(){i=this.getAttribute("mapid")||"none";r[i]=this.value.replace(/\n/gm,"<br>")||""});for(var s in r){o=o.replace("{"+s+"}",r[s])}}n.data("native",r);n.html(e(o)[0].innerHTML+b)}).on("click",".reset",function(t){var a=e(".mol-ctrl-wrap");var o=a.attr("ctrlid");if(o.indexOf("GoodList")>-1){e(".ctrlArea-goodsChecked-wrap").empty();h=[]}a.find("[type=text],[type=number],textarea,[type=file],[type=color]").each(function(){this.value=""});a.find("p.uploaded-info,p.upload-ok-tip").remove()});x.on("click",".show-goods-list",function(){var t=e(this).parent().attr("ctrlid");G.data("for-ctrlid",t);H();m=[];B(h,false,true)});function I(t,a){var o,i,r=e("<div>");if(a==1){o='<div class="" molid="singleGood"></div>';i='<a class="singleGood-wrap-one"  > <img src="{picPath}" ><p>{name}</p><i>￥{price}</i></a>'}else{o='<div class="" molid="doubleGood"></div>';i='<a class="doubleGood-wrap-one"  > <img src="{picPath}" ><p>{name}</p><i>￥{price}</i></a>'}var n,c,s=e(o)[0];t.forEach(function(l,d){n=i.replace("{name}",l["name"]).replace("{picPath}",l["thumbnail"]||l["picPath"]).replace("{href}",l["href"]).replace("{price}",l["price"]);c=e(n)[0];if(a==1){r[0].appendChild(c)}else{if(d%2==0){s=e(o)[0]}s.appendChild(c);if(d%2!=0||d==t.length-1){r[0].appendChild(s)}}});return r.html()+P}function B(t,a,o){var i,r,n;t.every(function(t,c){if(L.children().length<12){r=t["picPath"]||t["thumbnail"];n=e("<img>").prop("src",r);i=e('<div class="good-tag">').append(n).append("<i>&times;</i>").data("good-info",t);if(!T[t["goods_id"]||t["goodsId"]]){i.addClass("disabled")}if(!a){o?m.push(t):h.push(t);L.append(i)}return true}else{A("首页推荐宝贝列表最多装载12个, 其余的可点击[全部宝贝]查看");return false}})}e("#goods-list").on("click",".good-cell",function(){var t=e(this).data("good-info");var a=m.map(function(e){return e.goods_id||e.goodsId});var o=a.indexOf(+(t["goods_id"]||t["goodsId"]))>-1;B([t],o,true)});function E(t,a){var o=e(this).parent().index();a?m.splice(o,1):h.splice(o,1);e(this).parent().remove()}L.on("click","i",function(e){E.bind(this)(e,true)});x.on("click",".ctrlArea-goodsChecked-wrap i",E);window.test=function(){console.table(h)};G.click(function(){var t=this;var a=e("#show-mobile").find(".mol-wrap").eq(+e("#ctrl-wrap").data("index"));var o=e(t).data("for-ctrlid")=="doubleGoodList"?2:1;a.html(I(h,o)+b);h=m.slice();a.data("native",h);N();A("宝贝挑选成功",900)});function N(e){L.empty();j.empty();m=[];!e&&S()}k.click(N);e("#goods-modal .close").click(function(){N(true)});function H(t){var a=C.val();e.ajax({url:o,data:{pageSize:20,pageNum:t||1,keyword:a},type:"post"}).always(function(t){console.info(t);if(t.result==1){var a;j.empty();var o=e(document.createDocumentFragment());t.data.forEach(function(t,i){a=e(u.replace(/\{name\}/gm,t["name"]).replace("{picPath}",t["thumbnail"]||t["picPath"]).replace("{href}","#/tab/goods/"+t["goodsId"]).replace("{price}",t["price"]));a.data("good-info",t);o.append(a)});j.append(o);e("#now-pagenum").text(t.page.pageNum);e("#total-pagenum").text(t.page.pageCount)}else{console.info(t)}})}e(".btn-search").click(function(){H(1)});e(".go-next").click(function(){var t=+e("#now-pagenum").text();if(t==e("#total-pagenum").text()){return false}H(t+1)});e(".go-prev").click(function(){var t=+e("#now-pagenum").text();if(t<2){return false}H(t-1)});e(".go-first").click(function(){var t=+e("#now-pagenum").text();if(t==1||t==0){return false}H(1)});e(".go-last").click(function(){var t=+e("#now-pagenum").text();var a=+e("#total-pagenum").text();if(t==a){return false}H(a)});e(document).on("submit",".img-up-form",M);function M(){var t=e(".img-up-file")[0].files;if(!t.length){return false}else if(t.length>3){A("最多上传3张图片");return false}for(var a=0;a<t.length;a++){if(t[a].size>200*1024){A("单张图片大小不能超过200k,请压缩后重新上传");return false}}var o=new FormData(e(".img-up-form")[0]);e.ajax({url:r,type:"POST",data:o,dataType:"JSON",cache:false,processData:false,contentType:false,success:function(t){if(t.result==1){t.srcs=t.data}else{console.info(t);t.srcs=[]}if(t.srcs){var a=e("#show-mobile").find(".mol-wrap").eq(+e("#ctrl-wrap").data("index")),o=document.getElementsByClassName("mol-ctrl-wrap")[0],i=document.createDocumentFragment(),r,n;a.data("native",t.srcs);e(".mol-ctrl-wrap").find("[mapid^=imgsrc]").each(function(a,o){this.value=t.srcs[a]||this.value;if(a<t.srcs.length){e(this).css("background","#fbb")}});a.find("img")[0].src=t.srcs[0];A("上传成功,图片地址已经依次填入文本框. 也可以手动剪切图片地址, 调整次序.",2400);e(".img-up-file")[0].value=null}}});return false}e("#btn-count").click(function(){console.info(p)});function F(){var t=[];var a={};var o;var i=[];var r=e("#show-mobile").find(".mol-wrap");r.each(function(t,r){o=this.getAttribute("molid");if(o=="tb-category"){e(this).data("native",null)}else if(o.lastIndexOf("GoodList")>-1){e(this).data("native",e(this).data("native")||g.slice(0,8));e(this).data("native").forEach(function(e){a[e.goods_id+""]=""})}i.push({name:o,data:e(this).data("native")||d["val-"+o]||null})});for(var n in a){t.push(n)}console.log(t);console.table(i);return{content:JSON.stringify(i),goods_id_arr:t}}e(".btn-save").click(function(){if(!confirm("\n确定发布? \n\n将把店铺首页更新为当前页面的布置\n")){return false}var t=F();var a=t.content;var o=e("#shopId-inp").val();var r=e("#shopName-inp").val();e.post(i,{shopId:o||"",shopName:r||"",content:a,goodsIds:t.goods_id_arr.join(",")}).always(function(t){console.info(t);if(t.result){localStorage.hdDecorateTempSaveData="";A('<b>发布成功!</b><a href="#" target="_blank">&nbsp;&nbsp;&nbsp;立刻前往我的店铺查看效果</a>'.replace("#",e("#goto-shop")[0].href),1500)}else if(t.resul.msg="session过期"){localStorage.hdDecotateTempSaveData=a;A("登陆状态过期,请刷新重新登陆!")}})});e(".temp-save").click(function(){var e=F().content;localStorage.hdDecorateTempSaveData=e;A("暂存成功,下次本机打开可以继续编辑.",600)});var q=function(t){var a=e("#never-again")[0].checked;a&&(localStorage.hdDecorateHelpKnew=1);e(".mask-main").hide();e("#main").removeClass("blur");if(t===true){e("#helps p").animate({width:0,height:30},300,function(){e(this).hide(200)})}else{e("#helps p").hide()}};var R=function(t){e("#helps").show();e("#helps p").css({width:208,height:118}).show();t===true&&e(".mask-main").show();e("#main").addClass("blur")};var z=function(){e("#btn-help").mouseenter(R).mouseleave(q)};e("#helps .btn,.mask-main").on("click",function(){q(true);z()});e("document").ready(function(){localStorage.hdDecorateHelpKnew==1?z():R(true)});window.init_current=_;window.bootAlert=A}})(window.jQuery);