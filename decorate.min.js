(function(e){var t=window.navigator.userAgent.indexOf("Chrome")>-1;if(!t){document.body.innerHTML='<br><h2>&nbsp;您目前的浏览器不是chrome(谷歌)浏览器，不支持相关操作。 请更换浏览器后再进入本页面。<br>&nbsp;<a href="https://www.baidu.com/s?ie=UTF-8&wd=chrome">点击此处下载</a></h2>'}else{var a=function(e){return document.getElementById("temp-"+e).innerHTML};var i=function(e){return document.getElementById("temp-ctrl-"+e).innerHTML};var o={"tb-features":"品牌优势,四个圆圆的LOGO,醒目展现亲小店的优势","hd-features":"品牌优势,四个圆圆的LOGO,醒目展现亲小店的优势","bb-features":"品牌优势,四个圆圆的LOGO,醒目展现亲小店的优势","hd-brands":"各大品牌LOGO陈列,一个品牌一个贴图,琳琅满目,快拖进手机里看看吧~","tb-category":"商品分类,列出宝贝的几大类,供顾客挑选哦~","bb-category":"商品分类,列出宝贝的几大类,供顾客挑选哦~","hd-category":"商品分类,列出宝贝的几大类,供顾客挑选哦~",singleGood:"这是单宝贝模块, 拖入手机 ,然后点击,可以在右侧自定义宝贝的信息",doubleGood:"这是双宝贝模块,两个宝贝并列, 拖入手机后点击,在右侧自定义宝贝的信息",singlePic:"单图片模块,一般选择一张宣传热图, 或者,可以一张装饰性的图片, 如果是纯装饰性的 ,可以不要文字和链接",slideBox:"轮播图片模块,也称幻灯片,可以选择多张图片(直接输入链接或上传),将在首页自动切换轮播",doublePic:"并列图片,一般用来做品牌区域,块状LOGO图","tb-category":"4格图片,一般用来做品牌或类别分类",wordPic:"图文并茂, 做图需要美工在左侧纯色或留白",titleOnly:"纯文字的标题,用于分段标注",wordOnly:"纯粹的文字,说一些你想跟卖家说的话吧",contract:"您的联系电话,写上电话卖家更容易联系到你",singleGoodList:"这是一个宝贝列表模块,有很多行, 每行一次展示一个宝贝,包括图片,文字介绍,和价格, 具体设置请拖入手机后, 单击手机内该模块",doubleGoodList:"这是一个宝贝列表模块,有很多行, 每行展示两个宝贝,包括图片,文字介绍,和价格, 具体设置请拖入手机后, 单击手机内该模块"};var n={"val-singleGood":{href:"#",picPath:"img/decorate/re-good.jpg",name:"宝乐滋3罐超值特价装!",price:92},"val-doubleGood":{href:"#",picPath:"img/decorate/good17.jpg",name:"漂亮的女童裤子 纯棉",price:56,href2:"#",picPath2:"img/decorate/good13.jpg",name2:"小脚裤子批发 颜色多",price2:52},"val-wordPic":{href:"#",imgsrc:"img/decorate/word-pic.jpg",desc:"图片描述文字,一些文字,怕怕拉拉,什么的<br>或者,图片可以做成100%<br>文字遮罩在图片左上角<br>这需要图片设计配合<br>左上角统一色调或留白"},"val-slideBox":[{href:"#",imgsrc:"img/decorate/slide.jpg"},{href:"#",imgsrc:"img/decorate/slide2.jpg"},{href:"#",imgsrc:"img/decorate/slide3.jpg"}],"val-singlePic":{href:"#",imgsrc:"img/decorate/baby-house.jpg",desc:"婴童夏装换季清仓中! 点击进入专区!"},"val-doublePic":{href:"#",imgsrc:"img/decorate/baby-joy01.jpg",desc:"童车特价中! 点击进入专区!",href2:"#",imgsrc2:"img/decorate/baby-joy02.jpg",desc2:"玩具特价! 点击进入专区!"},"val-tb-category":{href:"#",imgsrc:"img/decorate/area-logo-01.jpg",desc:"LOGO AREA<br>奶粉专区",href2:"#",imgsrc2:"img/decorate/area-logo-02.jpg",desc2:"LOGO AREA<br>日用品专区",href3:"#",imgsrc3:"img/decorate/area-logo-03.jpg",desc3:"LOGO AREA<br>尿不湿专区",href4:"#",imgsrc4:"img/decorate/area-logo-04.jpg",desc4:"LOGO AREA<br>妈妈专区"},"val-bannerPic":{imgsrc:"img/decorate/banner.jpg",href:"#"},"val-bb-category":{imgsrc:"img/decorate/masonry.png"},"val-bb-features":{imgsrc:"img/decorate/bb-features.png"},"val-titleOnly":{title:"推荐宝贝"},"val-wordOnly":{desc:"欢迎光临小店!<br>本店的所有商品都是真宗境外海淘<br>海关保税仓发货, 优惠多多, 还有包邮,欢迎亲多多选购~~~ "},"val-contract":{tel:"1381396655",wechat:"weixina2017006"}};var r={"tb-features":2,"bb-features":2,"hd-features":2,"tb-category":2,"bb-category":2,"hd-category":2,"hd-brands":2,singleGood:16,doubleGood:12,slideBox:1,singlePic:16,bannerPic:16,doublePic:2,wordPic:3,wordOnly:3,titleOnly:12,contract:2,singleGoodList:1,doubleGoodList:1};var l={tempDefault:["singlePic","wordOnly","hd-brands","titleOnly","singleGoodList","contract"],tbstyle:[{name:"singlePic"},{name:"wordOnly"},{name:"tb-features"},{name:"titleOnly",data:{title:"热门品类"}},{name:"tb-category"},{name:"titleOnly"},{name:"doubleGoodList"},{name:"contract"}],bbstyle:[{name:"slideBox"},{name:"bb-features"},{name:"bb-category"},{name:"titleOnly",data:{title:"热门推荐"}},{name:"bannerPic"},{name:"bannerPic",data:{imgsrc:"img/decorate/banner2.jpg",href:"#"}},{name:"bannerPic",data:{imgsrc:"img/decorate/banner3.jpg",href:"#"}},{name:"bannerPic",data:{imgsrc:"img/decorate/banner4.jpg",href:"#"}},{name:"bannerPic",data:{imgsrc:"img/decorate/banner5.jpg",href:"#"}},{name:"titleOnly",data:{title:"热销宝贝"}},{name:"singleGood"},{name:"singleGood",data:{href:"#",picPath:"img/decorate/re-good2.jpg",name:"秋装新款 童装毛衣 外贸出口!",price:52}},{name:"singleGood",data:{href:"#",picPath:"img/decorate/re-good3.jpg",name:"宝宝的小屁屁最好的呵护~~~ 金装尿不湿!",price:168}},{name:"titleOnly"},{name:"doubleGoodList"},{name:"contract"}],hdstyle:[{name:"slideBox",data:[{href:"#",imgsrc:"img/decorate/hot.jpg"},{href:"#",imgsrc:"img/decorate/hot2.jpg"}]},{name:"hd-features"},{name:"titleOnly",data:{title:"品牌馆"}},{name:"hd-brands"},{name:"titleOnly",data:{title:"热门分类"}},{name:"hd-category"},{name:"titleOnly"},{name:"singleGoodList"},{name:"contract"}]};var c="http://localhost:3000/goods";var s="http://localhost:3000/shopDataSave";var d="http://localhost:8080/goods/appUploadShopPic";var f=[];var g=[];var p=function(t,a){e(".alert-assertive").fadeIn(300,function(){setTimeout(function(){e(this).fadeOut(600)}.bind(this),a||3200)}).html(function(e,a){return t});return false};e(".alert-assertive").click(function(){e(this).hide()});e(".main-help>.close").click(function(){e(this).parent().after("<hr>").hide()});var m=function(t){if(typeof t=="undefined"||!t){return false}var i,o,c,s,d,g,p,m=e("#show-mobile")[0];var u=l[t]||[];for(s=0;s<u.length;s++){g=u[s].name;p=u[s].data||n["val-"+g];i=a(g);if(g=="slideBox"){i=i.replace("{imgsrc}",p[0]["imgsrc"]).replace("{href}",p[0]["href"])}else if(g.lastIndexOf("GoodList")>-1){p=p||f.slice(0,12);i=i.replace("{content}",goods_list_instance(p,g.indexOf("single")==0?1:2))}else{for(d in p){i=i.replace("{"+d+"}",p[d])}}c=e(i)[0];c.innerHTML+='<a class="go-recycle">删除</a><a class="go-up">移上</a><a class="go-down">移下</a>';m.appendChild(c);e(c).data("native",p);r[c.getAttribute("molid")]-=1}e(".go-recycle,.go-up,.go-down").hide()};e("a[tempid]").on("click",function(){e("#show-mobile").find(".mol-wrap").each(function(){e(this).remove();r[this.getAttribute("molid")]++});e("#ctrl-wrap").empty();m(e(this).attr("tempid"))});e("#show-mobile").on("drop",function(t){event.preventDefault();var i=event.dataTransfer.getData("Text");var o=i.replace("tag-","");var l=e(".mol-wrap").filter(".blue-top")[0];if(!r[o]&&i.indexOf("tag")==0){p("该组件的使用次数已达上限。");return false}var c=a(o);var s=n["val-"+o];if(o=="slideBox"){c=c.replace("{imgsrc}",s[0]["imgsrc"]).replace("{href}",s[0]["href"])}else if(o.lastIndexOf("GoodList")>-1){c=c.replace("{content}",goods_list_instance(f.slice(0,6),o.indexOf("single")==0?1:2))}else{for(var d in s){c=c.replace("{"+d+"}",s[d])}}var g=e(c)[0];g.innerHTML+='<a class="go-recycle">删除</a><a class="go-up">移上</a><a class="go-down">移下</a>';l?this.insertBefore(g,l):this.appendChild(g);r[g.getAttribute("molid")]--;e(".mol-wrap").removeClass("blue-top");e("#ctrl-wrap")[0].innerHTML=""}).on("dragenter",function(e){}).on("dragover",function(t){event.preventDefault();e(".mol-wrap").removeClass("assertive");e(".mol-wrap").removeClass("blue-top");e(event.target).parents(".mol-wrap").eq(0).addClass("blue-top")});e(".mol-tag").on("selectstart",function(e){return false}).on("dragstart",function(e){event.dataTransfer.setData("Text",this.id)}).on("dragend",function(t){event.preventDefault();e(".mol-tip").fadeOut(300,function(){e(this).html('<div class="arrow"></div>')})}).on("mousedown",function(){var t=this;e(".mol-tip").show().css("opacity",0).animate({top:e(this).parent().index()*44,opacity:.9},function(){e(this).html(function(e,t){return t+o[this.id.replace("tag-","")]}.bind(t))})}).on("mouseup",function(){e(".mol-tip").fadeOut(300,function(){e(this).html('<div class="arrow"></div>')})});e("#show-mobile").on("selectstart",".go-down,.go-up,.go-recycle",function(e){return false}).on("click",".go-recycle",function(t){event.preventDefault();e(this.parentNode).remove();r[this.parentNode.getAttribute("molid")]+=1}).on("click",".go-down",function(t){event.preventDefault();var a=this.parentNode;var i=a.nextSibling;if(i==null){return false}var o=e("#show-mobile")[0];var n=a.previousSibling;var r=i.cloneNode(true);o.removeChild(i);o.insertBefore(r,a)}).on("click",".go-up",function(t){event.preventDefault();var a=e(this).parent();var i=a.prev();if(i.length<1){return false}var o=i.clone();var n=a.next();i.remove();n.length?n.before(o):e("#show-mobile").append(o)}).on("mouseover",".mol-wrap",function(t){e(this).find(".go-down,.go-up,.go-recycle").show()}).on("mouseleave",".mol-wrap",function(t){e(this).find(".go-down,.go-up,.go-recycle").hide()}).on("click",".mol-wrap",function(t){var a=this.getAttribute("molid");var o=e(this).data("native")||n["val-"+a];var r;e(".mol-wrap").removeClass("assertive");e(this).addClass("assertive");e("#ctrl-wrap").data("index",e(this).index()-3).html(i(a));if(a=="slideBox"){var l=o;e(".mol-ctrl-wrap").find("[mapid^=imgsrc]").each(function(e,t){l[e]?this.value=l[e].imgsrc||"":void 0});e(".mol-ctrl-wrap").find("[mapid^=href]").each(function(e,t){l[e]?this.value=l[e].href||"":void 0})}else{e(".mol-ctrl-wrap").find("[type=text],[type=number],textarea").each(function(){r=this.getAttribute("mapid")||"none";if(o&&o[r])this.innerText?this.innerText=o[r]:this.value=(o[r]+"").replace(/\<br\>/gm,"\n")})}});e("#ctrl-area").on("click",".btn-submit",function(t){var i=e(".mol-ctrl-wrap").attr("ctrlid"),o=a(i),n,r={},l=e("#show-mobile").find(".mol-wrap").eq(+e("#ctrl-wrap").data("index"));if(i.indexOf("GoodList")>-1){return false}else if(i=="slideBox"){r=[];e(".mol-ctrl-wrap").find("[mapid^=imgsrc]").each(function(e,t){r[e]={imgsrc:this.value||""}}).end().find("[mapid^=href]").each(function(e,t){typeof r[e]=="object"&&r[e].imgsrc?r[e].href=this.value||"":void 0});o=o.replace("{imgsrc}",r[0]["imgsrc"]).replace("{href}",r[0]["href"])}else{e(this.parentNode).prev().find("input,textarea").each(function(){n=this.getAttribute("mapid")||"none";this.innerText?r[n]=this.innerText:r[n]=this.value.replace(/\n/gm,"<br>")});for(var c in r){o=o.replace("{"+c+"}",r[c])}}l.data("native",r);l.html(e(o)[0].innerHTML+'<a class="go-recycle">删除</a><a class="go-up">移上</a><a class="go-down">移下</a>')}).on("click",".show-good-list",function(){goods_list_cls();fillGoods()}).on("click",".btn-reset",function(t){e(".mol-ctrl-wrap").find("[type=text],[type=number],textarea,[type=file],[type=color]").each(function(){this.value=""});e(".mol-ctrl-wrap").find("p.uploaded-info,p.upload-ok-tip").remove()});window.post_ctrl_id=function u(t){e("#checked_done").data("for-ctrlid",e(t).parent().attr("ctrlid"))};window.goods_list_instance=function h(t,a){var i,o,n=e("<div>");if(a==1){i='<div class="" molid="singleGood"></div>';o='<a class="singleGood-wrap-one"  molid="singleGood" > <img src="{picPath}" ><p>{name}</p><i>￥{price}</i></a>'}else{i='<div class="" molid="doubleGood"></div>';o='<a class="doubleGood-wrap-one"  > <img src="{picPath}" ><p>{name}</p><i>￥{price}</i></a>'}var r,l,c=e(i)[0];t.forEach(function(s,d){r=o.replace("{name}",s["name"]).replace("{picPath}",s["picPath"]).replace("{href}",s["href"]).replace("{price}",s["price"]);l=e(r)[0];if(a==1){n[0].appendChild(l)}else{if(d%2==0){c=e(i)[0]}c.appendChild(l);if(d%2!=0||d==t.length-1){n[0].appendChild(c)}}});var s='<a class="all-goods-href">查看所有宝贝&nbsp;&gt;&gt;</a>';return n.html()+s};e(".btn-search").click(function(){fillGoods(1)});window.check_it=function v(t){var a=e("#good-checked-list");var i=e(t).data("good-info");var o=e('<div class="good-tag">');e(t).find("img").clone().appendTo(o);o.append("<i>&times;</i>");o.data("good-info",i);g.push(i);if(a.children().length<20){a.append(o)}else{p("首页推荐宝贝列表最多装载20个, 其余的可点击[全部宝贝]查看")}};e("#good-checked-list").on("click","i",function(){var t=e(this).parent().data("good-info");g.forEach(function(e,a){if(e.goods_id==t.goods_id){g.splice(a,1)}});e(this).parent().remove()});window.checked_done=function b(t){var a=e("#show-mobile").find(".mol-wrap").eq(+e("#ctrl-wrap").data("index"));var i;e(t).data("for-ctrlid")=="doubleGoodList"?i=2:i=1;a.html(goods_list_instance(g,i)+'<a class="go-recycle">删除</a><a class="go-up">移上</a><a class="go-down">移下</a>');a.data("native",g);goods_list_cls()};window.goods_list_cls=function w(){e("#good-checked-list").html("");e(".good-list").html("");g=[]};e.ajax(c).always(function(e){if(e.result){f=e.data}});window.fillGoods=function y(t){var a=e("#keyword-for-search").val();e.ajax({url:c,data:{pageSize:20,pageNum:t||1,keyword:a},type:"post"}).always(function(t){if(t.result==1){var a=e("#temp-good-cell").html();var i=e(".good-list");var o;i.html("");t.data.forEach(function(t,n){o=e(a.replace("{name}",t["name"]).replace("{picPath}",t["picPath"]).replace("{href}","#/tab/goods/"+t["goodsId"]).replace("{price}",t["price"]));o.data("good-info",t);i.append(o)});e("#now-pagenum").text(t.page.pageNum);e("#total-pagenum").text(t.page.pageCount)}else{console.info(t)}})};e(".go-next").click(function(){var t=+e("#now-pagenum").text();if(t==e("#total-pagenum").text()){return false}fillGoods(t+1)});e(".go-prev").click(function(){var t=+e("#now-pagenum").text();if(t<2){return false}fillGoods(t-1)});e(".go-first").click(function(){var t=+e("#now-pagenum").text();if(t==1||t==0){return false}fillGoods(1)});e(".go-last").click(function(){var t=+e("#now-pagenum").text();var a=+e("#total-pagenum").text();if(t==a){return false}fillGoods(a)});e(document).on("submit",".img-up-form",function(){var t=e(".img-up-file")[0].files;if(!t.length){return false}else if(t.length>5){p("最多上传5张图片");return false}for(var a=0;a<t.length;a++){if(t[a].size>200*1024){p("单张图片大小不能超过200k,请压缩后重新上传");return false}}var i=new FormData(e(".img-up-form")[0]);e.ajax({url:d,type:"POST",data:i,dataType:"JSON",cache:false,processData:false,contentType:false,success:function(t){if(t.result==1){t.srcs=t.data}else{console.info(t);t.srcs=[]}if(t.srcs){var a=e("#show-mobile").find(".mol-wrap").eq(+e("#ctrl-wrap").data("index")),i=document.getElementsByClassName("mol-ctrl-wrap")[0],o=document.createDocumentFragment(),n,r;a.data("native",t.srcs);e(".mol-ctrl-wrap").find("[mapid^=imgsrc]").each(function(a,i){this.value=t.srcs[a]||this.value;if(a<t.srcs.length){e(this).css("background","#fbb")}});a.find("img")[0].src=t.srcs[0];p("上传成功,图片地址已经自动填入文本框.",2400);e(".img-up-file")[0].value=null}}});return false});e("#btn-count").click(function(){console.info(r)});e(".btn-save").click(function(){var t=e("#shopId-inp").val();var a=e("#shopName-inp").val();var i;var o=[];var r=e("#show-mobile").find(".mol-wrap");r.each(function(t,a){i=this.getAttribute("molid");if(i=="tb-category"){e(this).data("native",null)}else if(i.lastIndexOf("GoodList")>-1){e(this).data("native",e(this).data("native")||goods_list_instance(f.slice(0,6)))}o.push({name:i,data:e(this).data("native")||n["val-"+i]||null})});console.table(o);var l=JSON.stringify(o);e.post(s,{shopId:t,shopName:a,content:l}).always(function(e){console.info(e);if(e.result){p("保存成功 OK!")}})})}})(window.jQuery);