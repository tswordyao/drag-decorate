<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <title>Document</title>
  <script src="hd.jquery.min.js"></script>
<!--   <script src="pub_js/angular-1.3.0.js"></script> -->
 </head>
 <body ng-app="dsale" ng-controller="dsaleCtrl">
   <div id="btn-wrap">
    <button id="btn-info">get the info</button>
    <button id="btn-count">get the count</button>
  </div>

  <div id="main">
    <ul id="model-list">
      <li id="li-01">
        <div class="mol-tag" id="tag-single-good" draggable="true" >单宝贝模块</div>
      </li>
      <li id="li-02">
        <div class="mol-tag" id="tag-double-good" draggable="true" >双宝贝模块</div>
      </li>
      <li id="li-03">
        <div class="mol-tag" id="tag-single-pic" draggable="true"  >单图片模块</div>
      </li>
      <li id="li-04">
        <div class="mol-tag" id="tag-double-pic" draggable="true"  >双图片模块</div>
      </li>
      <li id="li-05">
        <div class="mol-tag" id="tag-word-pic" draggable="true"  >左文右图模块</div>
      </li>
      <li id="li-06">
        <div class="mol-tag" id="tag-title-only" draggable="true"  >标题模块</div>
      </li>
      <li id="li-07">
        <div class="mol-tag" id="tag-word-only" draggable="true"  >文字模块</div>
      </li>
      <li id="li-08">
        <div class="mol-tag" id="tag-tel-only" draggable="true"  >电话模块</div>
      </li>
    </ul>

    <div id="show-mobile" class="" data-mcs-theme="dark">
      <div class="iphone-head"><i></i></div>
      <div class="iphone-foot"><i></i></div>
    </div>    

    <div id="ctrl-area">
      <div id="ctrl-wrap"></div>
      <div class="submit-reset-wrap">
        <input type="reset">
        <input type="submit">
      </div> 
    </div>

    <div class="clear"></div>
  </div>


  <!-- 模板 -->
  <script type="text/template" id="temp-single-good">
    <a class="mol-wrap" molid="single-good" ng-href="{href}">
      <img src="{imgsrc}" ng-src="{imgsrc}" alt="">
      <p><u>{goodname}</u><b>价格</b>￥<i>{price}</i></p>
   </a>
  </script>

  <script type="text/template" id="temp-double-good">
    <div class="mol-wrap" molid="double-good">
        <a class="double-good-wrap-one"  ng-href="{href}">
          <img src="{imgsrc}" ng-src="{imgsrc}" alt="">
          <p><u>{goodname}</u><b>价格</b>￥<i>{price}</i></p>
       </a>
        <a class="double-good-wrap-one"  ng-href="{href2}">
          <img src="{imgsrc2}" ng-src="{imgsrc2}" alt="">
          <p><u>{goodname2}</u><b>价格</b>￥<i>{price2}</i></p>
       </a>
    </div>
  </script>

  <script type="text/template" id="temp-single-pic">
    <a class="mol-wrap" molid="single-pic" ng-href="{href}">
      <img src="{imgsrc}" ng-src="{imgsrc}">
      <p>{desc}</p>
    </a>
  </script>

  <script type="text/template" id="temp-double-pic">
    <div class="mol-wrap" molid="double-pic">
      <div class="double-pic-wrap-one">
        <img src="good02.jpg" alt="">
        <p>图片描述1</p> 
      </div>
      <div class="double-pic-wrap-one">
        <img src="good01.jpg" alt="">
        <p>图片描述2</p>
      </div>
    </div> 
  </script>

  <script type="text/template" id="temp-word-pic">
    <div class="mol-wrap" molid="word-pic">
      <p>图片描述文字,一些文字</p>
      <img src="good03.jpg" alt="">
    </div>
  </script>


  <!-- 设置模板的模板 -->
  <script type="text/template" id="temp-ctrl-single-good">
    <div class="mol-ctrl-wrap" ctrlid="single-good">
      <input type="text"   mapid="imgsrc"     placeholder="输入宝贝图片地址">
      <input type="text"   mapid="href"       placeholder="输入宝贝链接地址">
      <input type="text"   mapid="goodname"   placeholder="输入宝贝名称"> 
      <input type="number" mapid="price"      placeholder="输入宝贝价格(纯数字,可精确到2位小数)">
   </div>
  </script>

  <script type="text/template" id="temp-ctrl-double-good">
    <div class="mol-ctrl-wrap" ctrlid="double-good">
      <input type="text"   mapid="imgsrc"     placeholder="输入宝贝1图片地址">
      <input type="text"   mapid="href"       placeholder="输入宝贝1链接地址">
      <input type="text"   mapid="goodname"   placeholder="输入宝贝1名称"> 
      <input type="number" mapid="price"      placeholder="输入宝贝1价格(纯数字,可精确到2位小数)">
      <br><hr><br>
      <input type="text"   mapid="imgsrc2"    placeholder="输入宝贝2图片地址">
      <input type="text"   mapid="href2"      placeholder="输入宝贝2链接地址">
      <input type="text"   mapid="goodname2"  placeholder="输入宝贝2名称"> 
      <input type="number" mapid="price2"     placeholder="输入宝贝2价格(纯数字,可精确到2位小数)">
   </div>
  </script>

  <script type="text/template" id="temp-ctrl-single-pic">
    <div class="mol-ctrl-wrap" ctrlid="single-pic">
      <input type="text"   mapid="imgsrc"     placeholder="输入图片地址">
      <input type="text"   mapid="href"       placeholder="输入链接转向地址">
      <input type="text"   mapid="desc"       placeholder="输入图片文字描述"> 
   </div>
  </script>


  <!-- 映射模型 -->
  <script type="text/javascript">

      //模板映射  
      window.mol_dic={
        'single-good':document.getElementById('temp-single-good').innerHTML,
        'double-good':document.getElementById('temp-double-good').innerHTML,
        'single-pic':document.getElementById('temp-single-pic').innerHTML,
        'double-pic':document.getElementById('temp-double-pic').innerHTML,
        'word-pic':document.getElementById('temp-word-pic').innerHTML
      };
      //模板使用状态机 
      window.mol_count_dic={
        'single-good':0,
        'double-good':0,
        'single-pic':0,
        'double-pic':0,
        'word-pic':0
      };
      //编辑模板映射
      window.mol_ctrl_dic={
        'single-good':document.getElementById('temp-ctrl-single-good').innerHTML,
        'double-good':document.getElementById('temp-ctrl-double-good').innerHTML,
        'single-pic':document.getElementById('temp-ctrl-single-pic').innerHTML,
        //'double-pic':document.getElementById('temp-ctrl-double-pic').innerHTML,
        //'word-pic':document.getElementById('temp-ctrl-word-pic').innerHTML

      };
      //模板映射默认值
      window.mol_val_dic={
        "val-single-good":{
                          href:'www.163.com',
                          imgsrc:'good01.jpg',
                          goodname:'优质棉麻男童马夹 保暖透气',
                          price:92.00
        },
        "val-double-good":{
                          href:'www.163.com',
                          imgsrc:'good03.jpg',
                          goodname:'漂亮的女童裤子 纯棉',
                          price:56.00,
                          href2:'www.163.com',
                          imgsrc2:'good02.jpg',
                          goodname2:'小脚裤子批发 颜色多',
                          price2:52.00
        },
        "val-single-pic":{
                          href:'www.163.com',
                          imgsrc:'hot.png',
                          desc:'婴童夏装换季清仓中! 点击进入专区!',
        },
        "val-double-pic":{
                          href:'www.163.com',
                          imgsrc:'hot.png',
                          goodname:'漂亮的女童裤子 纯棉',
                          price:56.00,
                          href2:'www.163.com',
                          imgsrc2:'good02.jpg',
                          goodname2:'小脚裤子批发 颜色多',
                          price2:52.00
        }
      };

      //拖入的容器
      $('#show-mobile').on('drop',function(e){
          event.preventDefault();
          //console.log('drop');
          var transData=event.dataTransfer.getData("Text");
          var target= $('.mol-wrap').filter('.blue-top')[0];//console.info(target);
          var html=window.mol_dic[transData.replace('tag-','')];
          var defaultVals=window.mol_val_dic[transData.replace('tag-','val-')];
          for(var k in defaultVals){
            html=html.replace('{'+k+'}',defaultVals[k]);
          }
          var div=$(html)[0];
          div.innerHTML+= '<a class="go-recycle">删除</a><a class="go-up">移上</a><a class="go-down">移下</a>'
          target?this.insertBefore(div,target):this.appendChild(div);
          window.mol_count_dic[div.getAttribute('molid')]+=1
          $('.mol-wrap').removeClass('blue-top');
          $('#ctrl-wrap')[0].innerHTML='';
      })
      .on('dragenter',function(e){
          //event.preventDefault();
          //console.info('dragenter!');
      })
      .on('dragover',function(e){
          event.preventDefault();
          $('.mol-wrap').removeClass('assertive');
          $('.mol-wrap').removeClass('blue-top');
          $(event.target).parents('.mol-wrap').eq(0).addClass('blue-top');
      });


     //被拖动控件
     $('.mol-tag').on('selectstart',function(e){
       return false;
     })
     .on('dragstart',function(e){
       //console.log('\ndragstart-----');
       event.dataTransfer.setData("Text",this.id);
    })
    .on('dragend',function(e){
       //console.log('--------dragend\n');
       event.preventDefault();
    });


    //模板排列信息
    $('#btn-info').click(function(){
      var json=[];
      var mols=$('#show-mobile').find('.mol-wrap');
      mols.each(function(v,i){
        json.push({
          'molid':this.getAttribute('molid'),
          'imgsrc':$(this).find('img')[0].getAttribute('src'),
          'goodname':$(this).find('p')[0].innerHTML
        })
      });
      console.table(json);
    });
    $('#btn-count').click(function(){
      console.info(window.mol_count_dic);
    });


    //上下移动和删除
    $('#show-mobile').on('selectstart','.go-down,.go-up,.go-recycle',function(e){
    return false;
    })
    .on('click','.go-recycle',function(e){
      event.preventDefault();
      window.mol_count_dic[this.parentNode.getAttribute('molid')]-=1
      $(this.parentNode).remove();
    })
    .on('click','.go-down',function(e){
      event.preventDefault();
      var parent=this.parentNode;
      var next=parent.nextSibling;
      if(next==null){
        return false;
      }
      var grand=$('#show-mobile')[0];
      var prev=parent.previousSibling;
      var next2=next.cloneNode(true);
      grand.removeChild(next);
      grand.insertBefore(next2,parent);
    })
    .on('click','.go-up',function(e){
      event.preventDefault();
      var parent=$(this).parent();
      var prev=parent.prev();
      if(prev.length<1){
        return false;
      }
      var prev2=prev.clone();
      var next=parent.next();
      prev.remove();
      next.length?next.before(prev2):$('#show-mobile').append(prev2);
    })
    .on('mouseover','.mol-wrap',function(e){
        $(this).find('.go-down,.go-up,.go-recycle').show();
     })
     .on('mouseleave','.mol-wrap',function(e){
        $(this).find('.go-down,.go-up,.go-recycle').hide();
     })
     //载入控制台输入模板实例化信息
     .on('click','.mol-wrap',function(e){
        $('.mol-wrap').removeClass('assertive');
        $(this).addClass('assertive');
        $('#ctrl-wrap')[0].innerHTML= window.mol_ctrl_dic[this.getAttribute('molid')];
        $('#ctrl-wrap').data('index',$(this).index()-2);

        var molid,html,obj;
        $('#ctrl-wrap').find('input').each(function(){
            molid=molid||this.parentNode.getAttribute('ctrlid')||'none';
            html=html||window.mol_dic[molid];
            key=this.getAttribute('mapid')||'none';
            this.value=window.mol_val_dic['val-'+molid][key];
        });
     })

//      var dsale = angular.module("dsale", []);
//      dsale.controller('dsaleCtrl', function($localStorage,$scope){
//
//	    })
    //mCustomScrollbar
    /*
      $(window).load(function() {
        setTimeout(function(){
          $("#show-mobile").mCustomScrollbar();
        },9000);
      });
    */
    $('#ctrl-area [type=submit]').on('click',function(e){
        var molid;
        var molobj=$('#show-mobile').find('.mol-wrap').eq(+$('#ctrl-wrap').data('index'));
        var html;
        var obj={};
        var key;
        $(this.parentNode).prev().find('input').each(function(){
            molid=molid||this.parentNode.getAttribute('ctrlid')||'none';
            html=html||window.mol_dic[molid];
            key=this.getAttribute('mapid')||'none';
            obj[key]=this.value;
        });
      
        window.mol_val_dic['val-'+molid]=obj;
        for(var k in obj){
            html=html.replace('{'+k+'}',obj[k]);
        }
        molobj[0].innerHTML=$(html)[0].innerHTML;
    });
  </script>



  <style type="text/css">
    *{
      margin: 0;
      padding: 0;
    }
    .clear{
      clear:both;
    }
    #main{
      margin: 10px auto;
      padding: 10px;
      width: 1200px;
      overflow: hidden;
      background: #f2f2f2;
    }

    #model-list{
      float: left;
      width: 240px;
      height: 860px;
      border: 1px solid #bbc;
      border-radius:5px ;
    }

    #show-mobile{
      display: block;
      position:relative;
      margin-left: 50px;
      float: left;
      width: 380px;
      min-height: 720px;
      overflow: auto;
      border: 16px ridge #ccc;
      border-right: 16px groove #ccc;
      border-bottom: 16px groove #ccc;
      padding: 70px 10px 90px 10px;
      border-radius: 70px;
    }
    #show-mobile>.iphone-head,#show-mobile>.iphone-foot{
      position: absolute;
      left:0;
      width: 100%;
      line-height:60px;
      text-align: center;
      vertical-align: middle;
      background:#ccc;
    }
    #show-mobile>.iphone-head{
      top:0;
    }
    #show-mobile>.iphone-foot{
      bottom:0;
    }
    #show-mobile>.iphone-head>i{
      display: inline-block;
      width:160px;
      height:5px;
      background:#ddd;
      border-radius: 5px;
    }
    #show-mobile>.iphone-foot>i{
      display: inline-block;
      width:60px;
      height:60px;
      margin-top: 10px;
      margin-bottom: -15px;
      background:#ddd;
      border-radius: 50%;
    }
    #model-list li{
      display: block;
      height:62px;
      width:122px;
      margin: 15px auto;
      text-align: center;
    }
    #model-list .mol-tag{
      margin: 1px auto;
      width:  120px;
      line-height: 60px;
      background: silver;
      border-radius:5px ;
    }
    .drag-able,.drag-copy{
      position:absolute;
    }
    .drag-able{
      z-index: 9;
    }
    .mol-wrap{
      position: relative;
      width: 376px;
      min-height:160px;
      margin: 1px;
      padding: 1px;
      /*background: pink;*/
      border: 1px solid #aac;
      border-radius:3px ;
      overflow: hidden;
    }
    .mol-wrap>img{
      max-width:60%;
    }
    .mol-wrap>.go-up,.mol-wrap>.go-down,.mol-wrap>.go-recycle{
      display: block;
      position: absolute;
      top:2px;
      right:2px;
      line-height: 30px;
      width: 30px;
      font-size: 12px;
      text-align: center;
      border: 1px solid #ccc;
      background: rgba(6,6,6,0.2);
      border-radius:50%;
      color: #333;
    }
    .mol-wrap>.go-up:hover,.mol-wrap>.go-down:hover,.mol-wrap>.go-recycle:hover{
      background:rgba(0,0,0,0.6);
      color:#fff;
    }
    .mol-wrap>.go-up{
      right:36px;
    }
    .mol-wrap>.go-down{
      right:72px;
    }
    .blue-top{
      border-top:2px solid blue;
    }
    .mol-wrap img{
      max-width:99%;
    }
    .mol-wrap>div{
      float:left;
      width: 50%;
    }
    [molid=double-good]>img{
      display:inline-block;
      width:45%;
    }
    [molid=single-pic]>p{
      position: absolute;
      width:100%;
      bottom: 0;
      padding: 5px;
      background: rgba(0,0,0,0.6);
      color: #fff;
    }
    [molid=word-pic]>img,[molid=word-pic]>p{
      display:inline-block;
      width:45%;
    }
    #ctrl-area{
      position: relative;
      float: left;
      margin-left: 50px;
      width:360px;
      min-height:860px;
      border: 1px solid #bbc;
      border-radius:5px ;
    }
    #ctrl-area>.submit-reset-wrap{
      margin: 10px 5px;
      padding: 5px 10px;
    }
    #ctrl-area>.submit-reset-wrap>input{
      float: left;
      height: 36px;
      width: 80px;
      margin-left: 15px;
      border-radius:5px ;
    }
    .mol-ctrl-wrap{
      position: relative;
      padding: 10px;
    }

    .mol-ctrl-wrap>input[type=text],.mol-ctrl-wrap>input[type=number]{
      display: block;
      height:32px;
      width:296px;
      padding: 2px 5px;
      margin: 5px;
      border-radius:3px;
    }
    a.mol-wrap{
      display:block;
    }
    a.double-good-wrap-one{
      float: left;
      width: 49%;
    }
    .double-good-wrap-one p{
      font-size: 12px;
    }
    .double-good-wrap-one u{
      display: inline-block;
      width:120px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      text-decoration: none;
    }
    [molid=single-good] u{
      display: inline-block;
      width:260px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      text-decoration: none;
    }
    .assertive{
      border: 2px solid #f21;
    }
    #btn-info,#btn-count{
      display: inline-block;
      width:360px;
      height: 36px;
      margin: 5px;
      border-radius:10px;
      background: #ddf;
      outline:none;
    }
    #btn-wrap{
      width: 1200px;
      margin: 0 auto;
    }
  </style>

 </body>
</html>
